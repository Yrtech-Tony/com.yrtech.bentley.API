@{
    ViewBag.Title = "After2Days";
}

<div style="display:none">
    <input id="NO" type="hidden" value="{{'NO'|translate}}" />
    <input id="Dealer" type="hidden" value="{{'Dealer'|translate}}" />
    <input id="Promotion_State" type="hidden" value="{{'Promotion State'|translate}}" />
    <input id="In_Plan" type="hidden" value="{{'In Plan'|translate}}" />

    <input id="Promotion_Name" type="hidden" value="{{'Event Name'|translate}}" />
    <input id="Owner" type="hidden" value="{{'Owner'|translate}}" />
    <input id="TEdit" type="hidden" value="{{'Edit'|translate}}" />
    <input id="CustomerName" type="hidden" value="{{'Customer Name'|translate}}" />

    <input id="BPNumber" type="hidden" value="{{'BP Number'|translate}}" />
    <input id="HasCars" type="hidden" value="{{'Whether is Car Owner'|translate}}" />
    <input id="HasCars" type="hidden" value="{{'Whether is Car Owner'|translate}}" />

    <input id="WillJoin" type="hidden" value="{{'Whether Test Drive'|translate}}" />
    <input id="LikeCar" type="hidden" value="{{'LikeCar'|translate}}" />

    <input id="IsLeads" type="hidden" value="{{'Whether is Leads'|translate}}" />
    <input id="ActualOrdered" type="hidden" value="{{'Actual Order Info'|translate}}" />
    <input id="QuantitySold" type="hidden" value="{{'Quantity Sold'|translate}}" />
    <input id="ModelSold" type="hidden" value="{{'Model Sold'|translate}}" />
    <input id="CustomerIL" type="hidden" value="{{'Customer Inviting List'|translate}}" />
    <input id="WhetherDeal" type="hidden" value="{{'Whether Deal Made'|translate}}" />
</div>
<div id="page-wrapper">
    <!--BEGIN CONTENT-->
    <div class="page-content">
        <div id="main-content">
            <p>
                <a class="btn btn-primary" href="/Home/Promotion?type=" onclick="" translate>Save</a>
                <span style="padding-left:10px;" />
                <a class="btn btn-primary" style="margin-left:2px;" onclick="downloadFile()"><i class="icon-download-alt"></i><span translate>Export</span></a>
                <a class="btn btn-primary" style="margin-left:2px;" onclick="FileUpload()"><i class="icon-upload-alt"></i><span translate>Import</span></a>

            </p>

            <div class="widget">
                <div class="widget-title">
                    <h4><i class="icon-reorder"></i><span translate>Clue Report Excel</span></h4>
                    <span class="tools">
                        <a href="javascript:;" class="icon-chevron-down" onclick="ShowDiv()"></a>
                    </span>
                </div>
                <div class="widget-body form form-horizontal" style="display: block;">

                    <div class="dataTables_wrapper form-inline" role="grid">
                        <table id="myCueReport" class="table table-striped table-bordered table-hover"></table>
                        <div id="toolbar">
                            <div class="btn-group">
                                <a class="btn btn-default" href="javascript:;" onclick="Add()"><i class="glyphicon glyphicon-plus"></i><span translate>Add</span></a>
                                <a class="btn btn-default" href="javascript:;" onclick="Del()"><i class="glyphicon glyphicon-trash"></i><span translate>Delete</span></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--END CONTENT-->
    <!--BEGIN FOOTER-->

    <div id="footer" style="display:none">
        <div class="copyright">
            <table></table>
        </div>
    </div>
    <!--END FOOTER-->
</div>
@section scripts{
    <script src="~/Scripts/api/common.js"></script>
    <script src="~/Scripts/curtom/CueReport.js"></script>
    <script>
        $("#nav_promotion").addClass("active");

        var id = '@ViewBag.Id';
        if (id) {
            $.commonGet("MarketAction/MarketActionAfter2LeadsReportSearch", { marketActionId: id }, function (data) {
                if (data) {
                    $('#ActivityBudgetTable').bootstrapTable("load", data);
                }
            });
        }
        $(function () {
            loadShops().forEach(function (item) {
                var shopName = localStorage.language == 'en' ? item.ShopNameEn : item.ShopName;
                $("#ShopId").append($("<option>").val(item.ShopId).text(shopName));
            });

            loadActiveStatuss();
            loadTargetModels();
            loadEventTypes();

            InitCustomerInvitation2Table();
            InitOrderDetail();
            InitActualCost();

            var roleName = $('#G_RoleTypeCode').val();
            if (roleName == "SYSADMIN" || roleName == "MARKET") {
                $('#ActiveShow').show();
                $('#VisualStatus').prop("disabled", false);
            }
            else {
                $('#VisualStatus').prop("disabled", true);
            }
        });

        function loadActiveStatuss() {
            $.commonGet("Master/HiddenCodeSearch", {
                hiddenCodeGroup: "MarketActionStatus",
                hiddenCode: ""
            }, function (data) {
                data.forEach(function (item) {
                    $("#MarketActionStatusCode").append($("<option>").val(item.HiddenCodeId).text(localStorage.language == 'zh' ? item.HiddenCodeName : item.HiddenCodeNameEn))
                });
                $("#MarketActionStatusCode").selectpicker("refresh");
            })
        }

        function loadTargetModels() {
            $.commonGet("Master/HiddenCodeSearch", {
                hiddenCodeGroup: "TargetModels",
                hiddenCode: ""
            }, function (data) {
                data.forEach(function (item) {
                    $("#MarketActionTargetModelCode").append($("<option>").val(item.HiddenCodeId).text(localStorage.language == 'zh' ? item.HiddenCodeName : item.HiddenCodeNameEn))
                });
                $("#MarketActionTargetModelCode").selectpicker("refresh");
            })
        }

        function loadEventTypes() {
            $.commonGet("Master/EventTypeSearch", {
                eventTypeId: "",
                eventTypeName: "",
                eventTypeNameEn: ""
            }, function (data) {
                data.forEach(function (item) {
                    $("#EventTypeId").append($("<option>").val(item.EventTypeId).text(localStorage.language == 'zh' ? item.EventTypeName : item.EventTypeNameEn))
                });
                $("#EventTypeId").selectpicker("refresh");
            })
        }

        function OpenForm(obj) {
            var url = obj.src;
            url = url.replace('_min.', '.');
            if (!new RegExp('Content/bootstrap-fileinput/img/noimage').test(url)) {
                window.open(url);
            }
        }

        function filterWords(msg) {
            if (!isZH()) {
                return msg.replace("保存成功！", "Save Successfully !").replace("系统错误，请联系管理员！", "System error, please contact administrator!")
            }
            return msg;
        }
        function PromotionEdit3() {
            var StrDisplayModels = $('#DisplayModelsTable').bootstrapTable('getData');
            var StrTestDrive = $('#TestDriveTable').bootstrapTable('getData');
            var StrActivityBudget = $('#ActivityBudgetTable').bootstrapTable('getData');
            if (StrDisplayModels && StrDisplayModels.length > 0) {
                StrDisplayModels.forEach(function (item) {
                    item.MarketActionId = id;
                    item.InUserId = $("#G_UserId").val();
                    item.ModifyUserId = $("#G_UserId").val();
                })
            }
            if (StrTestDrive && StrTestDrive.length > 0) {
                StrTestDrive.forEach(function (item) {
                    item.MarketActionId = id;
                    item.InUserId = $("#G_UserId").val();
                    item.ModifyUserId = $("#G_UserId").val();
                })
            }
            if (StrActivityBudget && StrActivityBudget.length > 0) {
                StrActivityBudget.forEach(function (item) {
                    item.MarketActionId = id;
                    item.InUserId = $("#G_UserId").val();
                    item.ModifyUserId = $("#G_UserId").val();
                })
            }

            var MarketActionBefore3 = $('#PromotionCreate3').serializeObject();
            MarketActionBefore3.BugetDetailList = StrActivityBudget
            MarketActionBefore3.DisplayModelList = StrDisplayModels;
            MarketActionBefore3.TestDriverList = StrTestDrive;
            console.log(MarketActionBefore3);

            $.commonPost('MarketAction/MarketActionBefore3Save', {
                UserId: $("#G_UserId").val(),
                ListJson: JSON.stringify(MarketActionBefore3)
            }, function (data) {
                window.location.href = "/Marketing/Index";
            });
        }
    </script>
}